pipeline {
  agent any
  node {
    def artifactServer = Artifactory.server jfrogserver
    def artifactbuildInfo = Artifactory.newBuildInfo()
    def artifactbuildMaven = Artifactory.newMavenBuild()
    artifactbuildMaven.tool = 'MVN381'
  }
  environment {
    PATH = "/opt/maven381/bin/:$PATH"
  }
  stages {
    stage('clean') {
      steps{
        git "https://github.com/DTN91/Pipeline"
        sh "mvn clean"
        artifactbuildMaven.deployer releaseRepo:'Pipeline', server: artifactServer
        artifactbuildMaven.deployer.deployArtifacts = false
        artifactbuildInfo.env.capture = true
      }
    }
    stage('Build'){
      steps{
        sh "mvn install -DskipTests=true"
      }
    }
    stage('Upload to Artifactory'){
      steps{
        artifactbuildMaven.deployer.deployArtifacts artifactbuildInfo
        artifactServer.publishBuildInfo artifactbuildInfo
      }
    }
  }
}
